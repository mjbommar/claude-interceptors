#!/bin/bash
# Claude Interceptor for 'pip3' command

# Check for bypass flags
if [[ "$CLAUDE_INTERCEPTOR_BYPASS" == "1" ]] || [[ "$*" == *"--force"* ]]; then
    exec /usr/bin/pip3 "$@"
    exit $?
fi

# Parse the command to provide better suggestions
COMMAND="$1"
shift
ARGS="$*"

case "$COMMAND" in
    "install")
        echo "âŒ Direct pip3 install detected!"
        echo ""
        echo "ğŸ¤– AI Agent Instructions:"
        echo "  Choose the right uv command for your use case:"
        echo "  ğŸ“¦ uv add $ARGS                    # Add to pyproject.toml dependencies"
        echo "  ğŸ“¦ uv add --group dev $ARGS        # Add to dev dependency group" 
        echo "  ğŸ“¦ uv add --group test $ARGS       # Add to test dependency group"
        echo "  ğŸ“¦ uv pip install $ARGS            # Temporary install (no pyproject.toml change)"
        echo ""
        echo "ğŸ”§ To proceed anyway:"
        echo "  pip3 install $ARGS --force"
        echo "  CLAUDE_INTERCEPTOR_BYPASS=1 pip3 install $ARGS"
        ;;
    "freeze")
        echo "âŒ Direct pip3 freeze detected!"
        echo ""
        echo "ğŸ¤– AI Agent Instructions:"
        echo "  For better dependency management:"
        echo "  ğŸ“‹ uv pip freeze"
        echo "  ğŸ“‹ uv export --format requirements-txt"
        echo ""
        echo "ğŸ”§ To proceed anyway:"
        echo "  pip3 freeze --force"
        ;;
    *)
        echo "âŒ Direct pip3 usage detected!"
        echo ""
        echo "ğŸ¤– AI Agent Instructions:"
        echo "  Consider using uv instead:"
        echo "  âš¡ uv pip $COMMAND $ARGS"
        echo ""
        echo "ğŸ”§ To proceed anyway:"
        echo "  pip3 $COMMAND $ARGS --force"
        echo "  CLAUDE_INTERCEPTOR_BYPASS=1 pip3 $COMMAND $ARGS"
        ;;
esac

echo ""
echo "ğŸ’¡ Learn more: https://docs.astral.sh/uv/"
echo "ğŸ”§ Disable globally: claude-interceptor disable"

exit 1